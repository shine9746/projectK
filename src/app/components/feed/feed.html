<div class="posts-container">
    <div class="posts-header center-header">
        <h2 class="title feed-title">Feed</h2>
        <div class="actions">
            <button class="action-btn icon-btn" [ngClass]="refreshActive ? 'active-icon' : ''"
                (click)="toggleRefresh()">
                <mat-icon>refresh</mat-icon>
            </button>
            <button class="action-btn icon-btn" [ngClass]="filterActive ? 'active-icon' : ''" (click)="toggleFilter()">
                <mat-icon>filter_list</mat-icon>
            </button>
        </div>
    </div>
    <div class="posts-scroll">
        @if (posts().length === 0) {
        <p class="empty-state">No posts yet.</p>
        }
        @for (post of posts(); track post.id) {
        <div class="post-card">
            <div class="post-header">
                <img class="post-avatar" [src]="'https://localhost:7162'+post.postOwnerImage" />
                <div>
                    <h3 class="post-title">{{ post.postTitle }}</h3>
                    <h4>{{ post.postOwnerName }}</h4>
                    <span class="timestamp">{{ post.postCreationDate | date:'short' }}</span>
                </div>
            </div>
            <p class="post-content">{{ post.postContent }}</p>
            <div>
                <button mat-raised-button class="like-btn" [ngClass]="post.liked ? 'likeButton' : ''"
                    (click)="buttonAction(post,1)">
                    <mat-icon>thumb_up</mat-icon>
                    @if(post.postLikes > 0) {
                    <span>{{post.postLikes}}</span>
                    }
                </button>
                <button mat-raised-button class="dislike-btn" [ngClass]="post.disLiked ? 'disLikeButton': ''"
                    (click)="buttonAction(post,2)">
                    <mat-icon>thumb_down</mat-icon>
                    @if(post.postDisLikes > 0) {
                    <span>{{post.postDisLikes}}</span>
                    }
                </button>
            </div>
            <div class="comment-section">
                <button class="toggle-comments" (click)="toggleComments(post)">
                    <mat-icon>{{ post.showComments ? 'expand_less' : 'expand_more' }}</mat-icon>
                    {{ post.showComments ? 'Hide Comments' : 'Show Comments' }}
                </button>              
                @if (post.showComments) {
                <div class="comment-list">
                    @if (!post.comments || post.comments.length === 0) {
                    <p class="empty-comment">No comments yet.</p>
                    }
                    @if (post?.comments?.length) {
                    <span>{{post?.comments?.length}}</span>
                }
                    @for (comment of post?.comments; track comment.commentId) {
                    <div class="comment-item">
                        <strong>{{ comment.userName }}</strong>
                        <p>{{ comment.commentContent }}</p>
                        <span class="comment-date">{{ post.commentCreationDate | date:'short' }}</span>
                    </div>
                    }
                </div>
                }
                <div class="comment-input-row">
                    <input type="text" placeholder="Write a comment..." [(ngModel)]="post.comment"
                        class="comment-input" />
                    <button mat-raised-button color="primary" (click)="submitComment(post)">
                        Submit
                    </button>
                </div>
            </div>
        </div>
        }
    </div>
</div>